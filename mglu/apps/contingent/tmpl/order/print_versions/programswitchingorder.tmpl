<!ATTR order !>
<!-- Generated by details-generator. Do not edit! -->
<%
_CONDITIONS_ = ::DetailsForProgramSwitchingOrder.order_conditions(order)
header = import 'header', order
header.conditions = conditions = _CONDITIONS_

%>
<&header&>
<p></p>
<div style="text-align: center"><h3>ПРИКАЗЫВАЮ:</h3></div>
<%
list = Class.new(Array)
list.class_eval {
	alias_method :_old_find, :find
	def find(params = nil)
		if params.nil?
			_old_find { |item| yield item }
		else
			_old_find { |item| ret = params.collect { |k,v| item[k] == v }.inject(true) { |x,y| x && y } }
		end
	end
}
self.class.class_eval {
	def fetch(obj, method, *args)
		keys = args[-1]
		ret = []
		obj.__send__(method, *args) { |*values|
			h = {}; keys.each_index { |i|
				h[keys[i].intern] = values[i]
			}; ret << h
		}
		ret
	end
}

_SETS_ = []
_GROUPS_ = nil
@students = list.new(
	  fetch(order, :each_student, :all, %w( name student_status card_number group profession_code specialization_code degree_code student_id attributes ))
)
_LIST_ = [@students]

	@groups = _GROUPS_ = list.new(
	fetch(order, :each_group, %w( group_id current_term_number group_num group short_name department_num attributes ))
) if order.respond_to? :each_group

%>

<p>
		<% if conditions['profession_switching'] then %>
		Перевести с одной образовательной программы на другую
		нижеперечисленных лиц, обучающихся в МГЛУ, и установить индивидуальный
		график сдачи академических задолженностей, образовавшихся вследствие расхождения учебных
		планов:
		<% else %>
		Перевести из одной учебной группы в другую нижеперечисленных
		лиц, обучающихся в МГЛУ:</p>
		<% end %>
		</p>

<% _ITEM_INDEX_ = 0 %>
<% _LIST_[-1].each { |_ITEM_|
	name = _ITEM_[:name]
	student_status = _ITEM_[:student_status]
	card_number = _ITEM_[:card_number]
	group = _ITEM_[:group]
	profession_code = _ITEM_[:profession_code]
	specialization_code = _ITEM_[:specialization_code]
	degree_code = _ITEM_[:degree_code]
	attributes = _ITEM_[:attributes]
%>
	<h3>&#167; <%= _ITEM_INDEX_ = _ITEM_INDEX_ + 1 %></h3>
	<p>
	<%
	_HAS_FIELDS_ = false %>
	<% unless name.empty? then %><% if _HAS_FIELDS_ then %>; <% end %>
	<& name &><% _HAS_FIELDS_ = true;
	 end %>
	<% unless student_status.empty? then %><% if _HAS_FIELDS_ then %>; <% end %>
	<& student_status &><% _HAS_FIELDS_ = true;
	 end %>
	<% unless card_number.empty? then %><% if _HAS_FIELDS_ then %>; <% end %>
	Л.д. &#x2116;: <& card_number &><% _HAS_FIELDS_ = true;
	 end %>
	<% unless group.empty? then %><% if _HAS_FIELDS_ then %>; <% end %>
	Группа: <& group &><% _HAS_FIELDS_ = true;
	 end %>
	<% unless profession_code.empty? then %><% if _HAS_FIELDS_ then %>; <% end %>
	Код направления / специальности: <%= profession_code %><%= specialization_code || '00' %><%= degree_code || '00' %> <%= Classifier::Profession[profession_code][:name] %><% _HAS_FIELDS_ = true;
	 end %>
	<% if _CONDITIONS_['profession_switching'] then %>
	<% unless attributes['degree_code'].empty? then %><% if _HAS_FIELDS_ then %>; <% end %>
	Новая ступень образования: <& Classifier::Degree[attributes['degree_code']][:name] &>
	<% _HAS_FIELDS_ = true;
	 end %>
	<% end %>
	<% unless attributes['group_id'].empty? then %><% if _HAS_FIELDS_ then %>; <% end %>
	Числить в группе: <% require 'data/group'; %><%= Group.load(attributes['group_id'].to_i).name %>
	<% _HAS_FIELDS_ = true;
	 end %>
	<% unless attributes['profession_code'].empty? && attributes['specialization_code'].empty? && attributes['degree_code'].empty? then %><% if _HAS_FIELDS_ then %>; <% end %>
	Код направления / специальности (новый): <%= (!attributes['profession_code'].empty? && attributes['profession_code']) || order.attributes['profession_code'] || profession_code %><%= attributes['specialization_code'] || order.attributes['specialization_code'] || specialization_code || '00' %><%= attributes['degree_code'] || order.attributes['degree_code'] || degree_code || '00' %> <%= Classifier::Profession[attributes['profession_code'] || profession_code][:name] %><% _HAS_FIELDS_ = true;
	 end %>
	<% if _CONDITIONS_['profession_switching'] then %>
	<% unless attributes['card_number'].empty? then %><% if _HAS_FIELDS_ then %>; <% end %>
	Присвоить номер л.д.: <&attributes['card_number']&>
	<% _HAS_FIELDS_ = true;
	 end %>
	<% end %>
	<% if _CONDITIONS_['profession_switching'] then %>
	<% unless attributes['basic_agreement'].empty? then %><% if _HAS_FIELDS_ then %>; <% end %>
	Договор (контракт) о предоставлении платных образовательных услуг: <&attributes['basic_agreement']&>
	<% _HAS_FIELDS_ = true;
	 end %>
	<% end %>
	<% if _CONDITIONS_['profession_switching'] then %>
	<% unless attributes['addendum'].empty? then %><% if _HAS_FIELDS_ then %>; <% end %>
	Дополнение: <&attributes['addendum']&>
	<% _HAS_FIELDS_ = true;
	 end %>
	<% end %>
	<% if _CONDITIONS_['profession_switching'] then %>
	<% unless attributes['contract'].empty? then %><% if _HAS_FIELDS_ then %>; <% end %>
	к контракту: <&attributes['contract']&>
	<% _HAS_FIELDS_ = true;
	 end %>
	<% end %>
	<% unless attributes['start_at'].empty? then %><% if _HAS_FIELDS_ then %>; <% end %>
	Перевести с: <&attributes['start_at']&>
	<% _HAS_FIELDS_ = true;
	 end %>
	<% if _CONDITIONS_['profession_switching'] then %>
	<% unless attributes['liabilities'].empty? then %><% if _HAS_FIELDS_ then %>.<% end %>
	<div>Имеет академические задолженности:
	<table><thead><tr>
		<th>Название</th>
		<th>Отчетность</th>
	</tr></thead><tbody>
	<% (0...((attributes['liabilities'] || []).size)).each { |row| %>
	<tr>
		<td><& attributes['liabilities'][row]['subject'] &></td>
		<td><& attributes['liabilities'][row]['type'] &></td>
	</tr>
	<% } %>
	</tbody></table></div><% _HAS_FIELDS_ = false
	else %><% if _HAS_FIELDS_ then %>;<% end %>
	академических задолженностей нет.<%
	end %>
	<% end %>
	<% if _CONDITIONS_['profession_switching'] then %>
	<% unless attributes['deadline'].empty? then %><% if _HAS_FIELDS_ then %>; <% end %>
	Срок сдачи задолженностей: <&attributes['deadline']&>
	<% _HAS_FIELDS_ = true;
	 end %>
	<% end %>
	<% unless false then %><% if _HAS_FIELDS_ then %>; <% end %>
	Основания приказа: <%
		if not conditions['profession_switching'] then
	%>служебная записка зам.декана с резолюцией декана факультета<%
		elsif conditions['disabled'] then
	%><&attributes['basics']&><%
		else
	%>личное заявление обучающегося с визой декана факультета<% if conditions['foreign'] then %>,
	декана ФОИГ <% end %> и резолюцией проректора по учебной работе Университета<%

	unless attributes['basic_agreement'].empty? || attributes['additional_agreement'].empty? then
	%>, дополнительное соглашение <&attributes['additional_agreement']&>
	к договору (контракту) о предоставлении платных образовательных услуг <&attributes['basic_agreement']&>
	<% end
		end
	%>;<% _HAS_FIELDS_ = true;
	 end %>
	<% unless attributes['note'].empty? then %><% if _HAS_FIELDS_ then %>; <% end %>
	Примечания: <&attributes['note']&>
	<% _HAS_FIELDS_ = true;
	 end %>
	<% if _HAS_FIELDS_ then %>.<% end %>
	</p>
<% } %>

<% _SIGNATURE_INDEX_ = 0 %>
<table class="signatures">

	<% if (_SIGNATURE_INDEX_ += 1) == 2 then %><tr><td colspan="3"><b>Согласовано:</b></td></tr><% end %>
	<tr><td>Ректор МГЛУ</td><td class="signature">&nbsp;</td><td class="signspacer"/><td class="holder">И. И. Халеева</td><tr><tr><td></td><td class="small">(подпись)</td></tr>

	<% if (_SIGNATURE_INDEX_ += 1) == 2 then %><tr><td colspan="3"><b>Согласовано:</b></td></tr><% end %>
	<tr><td>Проректор по учебной работе</td><td class="signature">&nbsp;</td><td class="signspacer"/><td class="holder">И. В. Манохин</td><tr><tr><td></td><td class="small">(подпись)</td></tr>

	<% if _CONDITIONS_['profession_switching'] then %>
	<% if (_SIGNATURE_INDEX_ += 1) == 2 then %><tr><td colspan="3"><b>Согласовано:</b></td></tr><% end %>
	<tr><td>Начальник управления кадров</td><td class="signature">&nbsp;</td><td class="signspacer"/><td class="holder">Ю. И. Вторушин</td><tr><tr><td></td><td class="small">(подпись)</td></tr>
	<% end %>

	<% if _CONDITIONS_['foreign'] and _CONDITIONS_['profession_switching'] then %>
	<% if (_SIGNATURE_INDEX_ += 1) == 2 then %><tr><td colspan="3"><b>Согласовано:</b></td></tr><% end %>
	<tr><td>Проректор по международным связям</td><td class="signature">&nbsp;</td><td class="signspacer"/><td class="holder-unknown">&nbsp;</td><tr><tr><td></td><td class="small">(подпись)</td><td class="signspacer"/><td class="small">(расшифровка подписи)</td></tr>
	<% end %>

	<% if _CONDITIONS_['foreign'] and _CONDITIONS_['profession_switching'] then %>
	<% if (_SIGNATURE_INDEX_ += 1) == 2 then %><tr><td colspan="3"><b>Согласовано:</b></td></tr><% end %>
	<tr><td>Проректор по безопасности</td><td class="signature">&nbsp;</td><td class="signspacer"/><td class="holder-unknown">&nbsp;</td><tr><tr><td></td><td class="small">(подпись)</td><td class="signspacer"/><td class="small">(расшифровка подписи)</td></tr>
	<% end %>

	<% if not _CONDITIONS_['disabled'] or _CONDITIONS_['became_disabled'] then %>
	<% if (_SIGNATURE_INDEX_ += 1) == 2 then %><tr><td colspan="3"><b>Согласовано:</b></td></tr><% end %>
	<tr><td>Декан факультета &laquo;<%=order.faculty.name%>&raquo;</td><td class="signature">&nbsp;</td><td class="signspacer"/><td class="holder-unknown">&nbsp;</td><tr><tr><td></td><td class="small">(подпись)</td><td class="signspacer"/><td class="small">(расшифровка подписи)</td></tr>
	<% end %>

	<% if _CONDITIONS_['disabled'] then %>
	<% if (_SIGNATURE_INDEX_ += 1) == 2 then %><tr><td colspan="3"><b>Согласовано:</b></td></tr><% end %>
	<tr><td>Директор ГУИМЦ</td><td class="signature">&nbsp;</td><td class="signspacer"/><td class="holder-unknown">&nbsp;</td><tr><tr><td></td><td class="small">(подпись)</td><td class="signspacer"/><td class="small">(расшифровка подписи)</td></tr>
	<% end %>

	<% if not (_CONDITIONS_['disabled'] and _CONDITIONS_['became_disabled']) then %>
	<% if (_SIGNATURE_INDEX_ += 1) == 2 then %><tr><td colspan="3"><b>Согласовано:</b></td></tr><% end %>
	<%
	new_group_id = nil
	order.each_student(:all, ['attributes']) { |a|
		new_group_id = a['group_id'].to_i
	}
	receiver = Group.load(new_group_id).faculty.name
	if receiver != order.faculty.name then %>
	<tr><td>Декан факультета &laquo;<%=receiver%>&raquo;</td><td class="signature">&nbsp;</td><td class="signspacer"/><td class="holder-unknown">&nbsp;</td><tr><tr><td></td><td class="small">(подпись)</td><td class="signspacer"/><td class="small">(расшифровка подписи)</td></tr>
	<% end %>
	<% end %>

	<% if _CONDITIONS_['contract'] and not _CONDITIONS_['foreign'] and _CONDITIONS_['profession_switching'] then %>
	<% if (_SIGNATURE_INDEX_ += 1) == 2 then %><tr><td colspan="3"><b>Согласовано:</b></td></tr><% end %>
	<tr><td>Начальник учебно-организационного отдела</td><td class="signature">&nbsp;</td><td class="signspacer"/><td class="holder-unknown">&nbsp;</td><tr><tr><td></td><td class="small">(подпись)</td><td class="signspacer"/><td class="small">(расшифровка подписи)</td></tr>
	<% end %>

	<% if _CONDITIONS_['contract'] and not _CONDITIONS_['foreign'] and _CONDITIONS_['profession_switching']  then %>
	<% if (_SIGNATURE_INDEX_ += 1) == 2 then %><tr><td colspan="3"><b>Согласовано:</b></td></tr><% end %>
	<tr><td>Начальник планово-финансового управления</td><td class="signature">&nbsp;</td><td class="signspacer"/><td class="holder">Л. Н. Ермакова</td><tr><tr><td></td><td class="small">(подпись)</td></tr>
	<% end %>

	<% if _CONDITIONS_['foreign'] and _CONDITIONS_['profession_switching'] then %>
	<% if (_SIGNATURE_INDEX_ += 1) == 2 then %><tr><td colspan="3"><b>Согласовано:</b></td></tr><% end %>
	<tr><td>Декан ФОИГ</td><td class="signature">&nbsp;</td><td class="signspacer"/><td class="holder-unknown">&nbsp;</td><tr><tr><td></td><td class="small">(подпись)</td><td class="signspacer"/><td class="small">(расшифровка подписи)</td></tr>
	<% end %>

	<% if not _CONDITIONS_['profession_switching'] then %>
	<% if (_SIGNATURE_INDEX_ += 1) == 2 then %><tr><td colspan="3"><b>Согласовано:</b></td></tr><% end %>
	<tr><td>Начальник управления кадров</td><td class="signature">&nbsp;</td><td class="signspacer"/><td class="holder">Ю. И. Вторушин</td><tr><tr><td></td><td class="small">(подпись)</td></tr>
	<% end %>
</table>


<&import('footer', order)&>
